<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Тени Сознания | Психологическая игра</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #000;
            color: #e0e0e0;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            position: fixed;
            touch-action: manipulation;
        }

        /* Анимированный фон */
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #0a0a0a, #1a1a2e, #16213e, #0a0a0a);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            z-index: -1;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Частицы страха */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(255, 0, 102, 0.5);
            border-radius: 50%;
            animation: float 10s infinite;
        }

        @keyframes float {
            0%, 100% { 
                transform: translateY(0) translateX(0);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { 
                transform: translateY(-100vh) translateX(50px);
                opacity: 0;
            }
        }

        /* Контейнер игры */
        #game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            z-index: 10;
        }

        /* Верхняя панель статистики */
        #top-bar {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.9);
            border-bottom: 2px solid #ff0066;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stat-box {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(26, 26, 46, 0.8);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #444;
            font-size: 0.9em;
            flex: 1;
            min-width: 100px;
            justify-content: center;
        }

        .stat-icon {
            font-size: 1.2em;
        }

        .stat-value {
            font-weight: bold;
            color: #00ff88;
        }

        /* Шкала тревоги */
        .anxiety-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.8);
            position: relative;
            overflow: hidden;
        }

        .anxiety-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #ffaa00, #ff0066, #ff0000);
            transition: width 0.5s ease;
            box-shadow: 0 0 10px currentColor;
        }

        /* Основной контент */
        #content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* Экраны */
        .screen {
            display: none;
            width: 100%;
            max-width: 600px;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Главное меню */
        #menu-screen {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            border: 2px solid #ff0066;
            box-shadow: 0 0 30px rgba(255, 0, 102, 0.3);
        }

        .game-title {
            font-size: clamp(1.8em, 5vw, 3em);
            color: #ff0066;
            text-shadow: 0 0 20px #ff0066;
            margin-bottom: 15px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }

        .game-subtitle {
            font-size: clamp(0.9em, 3vw, 1.2em);
            color: #999;
            margin-bottom: 30px;
            font-style: italic;
        }

        .menu-description {
            font-size: clamp(0.8em, 2.5vw, 1em);
            line-height: 1.6;
            margin-bottom: 30px;
            color: #ccc;
            padding: 15px;
            background: rgba(255, 0, 102, 0.1);
            border-radius: 10px;
        }

        /* Кнопки */
        .btn {
            width: 100%;
            padding: 15px 30px;
            font-size: clamp(1em, 3vw, 1.2em);
            background: linear-gradient(135deg, #ff0066, #ff3388);
            border: none;
            border-radius: 10px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px 0;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(255, 0, 102, 0.4);
            touch-action: manipulation;
        }

        .btn:hover, .btn:active {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(255, 0, 102, 0.6);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #444, #666);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
        }

        .btn-secondary:hover, .btn-secondary:active {
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.6);
        }

        /* Игровой экран */
        #game-screen {
            padding: 20px;
        }

        .level-indicator {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            border: 2px solid #00ff88;
        }

        .level-title {
            font-size: clamp(1.2em, 4vw, 1.8em);
            color: #00ff88;
            margin-bottom: 5px;
        }

        .level-subtitle {
            font-size: clamp(0.8em, 2.5vw, 1em);
            color: #999;
        }

        /* Сценарий */
        .scenario-box {
            background: rgba(0, 0, 0, 0.9);
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #ff0066;
            margin-bottom: 25px;
            min-height: 150px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
        }

        .scenario-text {
            font-size: clamp(1em, 3vw, 1.2em);
            line-height: 1.8;
            color: #e0e0e0;
            animation: typeIn 1s ease;
        }

        @keyframes typeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Выборы */
        .choices {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .choice {
            padding: 18px;
            background: rgba(30, 30, 30, 0.9);
            border: 2px solid #555;
            border-radius: 12px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            font-size: clamp(0.9em, 2.5vw, 1.1em);
            position: relative;
            overflow: hidden;
            touch-action: manipulation;
        }

        .choice::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .choice:hover::before, .choice:active::before {
            left: 100%;
        }

        .choice:hover, .choice:active {
            background: rgba(50, 50, 50, 0.9);
            border-color: #00ff88;
            transform: translateX(5px);
        }

        .choice.dangerous:hover, .choice.dangerous:active {
            border-color: #ff0066;
            box-shadow: 0 0 15px rgba(255, 0, 102, 0.5);
        }

        .choice.safe {
            border-color: #00ff88;
        }

        .choice-icon {
            margin-right: 10px;
            font-size: 1.2em;
        }

        .choice-info {
            display: block;
            font-size: 0.8em;
            color: #999;
            margin-top: 5px;
        }

        /* Результаты */
        #result-screen {
            text-align: center;
            padding: 30px 20px;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 15px;
        }

        .result-title {
            font-size: clamp(1.5em, 5vw, 2.5em);
            margin-bottom: 20px;
            color: #ff0066;
            text-shadow: 0 0 20px #ff0066;
        }

        .result-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .result-stat {
            padding: 20px;
            background: rgba(26, 26, 46, 0.8);
            border-radius: 10px;
            border: 2px solid #444;
        }

        .result-stat-value {
            font-size: clamp(1.8em, 5vw, 2.5em);
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 5px;
        }

        .result-stat-label {
            font-size: clamp(0.8em, 2.5vw, 1em);
            color: #999;
        }

        .result-message {
            font-size: clamp(1em, 3vw, 1.3em);
            line-height: 1.8;
            margin: 25px 0;
            padding: 20px;
            background: rgba(255, 0, 102, 0.1);
            border-radius: 10px;
            border: 1px solid #ff0066;
        }

        /* Эффект тряски */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        .shake {
            animation: shake 0.5s;
        }

        /* Эффект затемнения */
        .darken {
            animation: darken 0.3s ease;
        }

        @keyframes darken {
            0% { filter: brightness(1); }
            50% { filter: brightness(0.3); }
            100% { filter: brightness(1); }
        }

        /* Мобильная оптимизация */
        @media (max-width: 768px) {
            #top-bar {
                padding: 8px 10px;
            }

            .stat-box {
                padding: 6px 10px;
                font-size: 0.8em;
                min-width: 80px;
            }

            #content {
                padding: 15px;
            }

            .scenario-box {
                padding: 18px;
                min-height: 120px;
            }

            .choice {
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .stat-box {
                flex: 1 1 calc(50% - 10px);
            }
        }

        /* Достижения */
        .achievement-popup {
            position: fixed;
            top: 80px;
            right: -350px;
            background: rgba(0, 0, 0, 0.95);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #00ff88;
            z-index: 1000;
            transition: right 0.5s ease;
            max-width: 300px;
        }

        .achievement-popup.show {
            right: 20px;
        }

        .achievement-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .achievement-title {
            color: #00ff88;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .achievement-text {
            font-size: 0.9em;
            color: #ccc;
        }

        /* Прогресс уровня */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff0066, #00ff88);
            transition: width 0.5s ease;
            box-shadow: 0 0 10px currentColor;
        }
    </style>
</head>
<body>
    <div class="animated-bg"></div>
    <div class="particles" id="particles"></div>
    
    <div id="game-container">
        <!-- Верхняя панель статистики -->
        <div id="top-bar">
            <div class="stat-box">
                <span class="stat-icon">🎯</span>
                <span>Уровень: <span class="stat-value" id="current-level">1</span></span>
            </div>
            <div class="stat-box">
                <span class="stat-icon">⭐</span>
                <span>Баллы: <span class="stat-value" id="score">0</span></span>
            </div>
            <div class="stat-box">
                <span class="stat-icon">💎</span>
                <span>Решений: <span class="stat-value" id="decisions">0</span></span>
            </div>
        </div>
        
        <!-- Шкала тревоги -->
        <div class="anxiety-bar">
            <div class="anxiety-fill" id="anxiety-fill" style="width: 0%"></div>
        </div>

        <!-- Основной контент -->
        <div id="content">
            <!-- Главное меню -->
            <div id="menu-screen" class="screen active">
                <h1 class="game-title">🎭 ТЕНИ СОЗНАНИЯ</h1>
                <p class="game-subtitle">Психологический триллер</p>
                <div class="menu-description">
                    Погрузитесь в мир внутренних страхов и противоречий. 
                    Каждое решение имеет последствия. Каждый выбор меняет вас.
                    Сможете ли вы сохранить рассудок в лабиринте собственного разума?
                </div>
                <button class="btn" onclick="game.startGame()">
                    🎮 Начать игру
                </button>
                <button class="btn btn-secondary" onclick="game.showRules()">
                    📖 Правила игры
                </button>
                <button class="btn btn-secondary" onclick="game.showStats()">
                    📊 Статистика
                </button>
            </div>

            <!-- Игровой экран -->
            <div id="game-screen" class="screen">
                <div class="level-indicator">
                    <div class="level-title" id="level-title">Уровень 1</div>
                    <div class="level-subtitle" id="level-subtitle">Пробуждение</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                    </div>
                </div>

                <div class="scenario-box">
                    <div class="scenario-text" id="scenario-text">
                        Загрузка сценария...
                    </div>
                </div>

                <div class="choices" id="choices">
                    <!-- Выборы добавляются динамически -->
                </div>
            </div>

            <!-- Экран результатов -->
            <div id="result-screen" class="screen">
                <h2 class="result-title" id="result-title">Конец игры</h2>
                
                <div class="result-stats">
                    <div class="result-stat">
                        <div class="result-stat-value" id="final-score">0</div>
                        <div class="result-stat-label">Баллов</div>
                    </div>
                    <div class="result-stat">
                        <div class="result-stat-value" id="final-level">0</div>
                        <div class="result-stat-label">Уровней</div>
                    </div>
                    <div class="result-stat">
                        <div class="result-stat-value" id="final-decisions">0</div>
                        <div class="result-stat-label">Решений</div>
                    </div>
                    <div class="result-stat">
                        <div class="result-stat-value" id="final-anxiety">0%</div>
                        <div class="result-stat-label">Тревоги</div>
                    </div>
                </div>

                <div class="result-message" id="result-message">
                    Ваш результат...
                </div>

                <button class="btn" onclick="game.restartGame()">
                    🔄 Играть снова
                </button>
                <button class="btn btn-secondary" onclick="game.backToMenu()">
                    🏠 В меню
                </button>
            </div>
        </div>
    </div>

    <!-- Всплывающее окно достижений -->
    <div class="achievement-popup" id="achievement-popup">
        <div class="achievement-icon" id="achievement-icon">🏆</div>
        <div class="achievement-title" id="achievement-title">Достижение!</div>
        <div class="achievement-text" id="achievement-text"></div>
    </div>

    <script>
        // Главный объект игры
        const game = {
            // Состояние игры
            state: {
                currentLevel: 1,
                score: 0,
                anxiety: 0,
                decisions: 0,
                currentScenarioIndex: 0,
                gameActive: false,
                maxLevels: 10
            },

            // База сценариев (ИСПРАВЛЕНО: снижены значения тревоги)
            scenarios: [
                // Уровень 1: Пробуждение
                {
                    level: 1,
                    title: "Пробуждение",
                    subtitle: "Туманное утро",
                    text: "Вы просыпаетесь в незнакомой комнате. Стены покрыты странными символами. За окном густой туман. Телефон на столе мигает тревожными сообщениями. Что вы сделаете?",
                    choices: [
                        { text: "📱 Проверить сообщения", anxiety: 3, score: 10, icon: "📱", type: "safe" },
                        { text: "🚪 Немедленно выйти из комнаты", anxiety: 8, score: 15, icon: "🚪", dangerous: true },
                        { text: "🔍 Изучить символы на стенах", anxiety: 2, score: 20, icon: "🔍", type: "safe" },
                        { text: "🪟 Посмотреть в окно", anxiety: 5, score: 15, icon: "🪟" }
                    ]
                },
                // Уровень 2: Коридор теней
                {
                    level: 2,
                    title: "Коридор теней",
                    subtitle: "Тени на стенах",
                    text: "Вы оказываетесь в бесконечном коридоре. На стенах пляшут странные тени, хотя источника света не видно. Слышны шаги... или это эхо ваших собственных?",
                    choices: [
                        { text: "🏃 Побежать вперёд", anxiety: 10, score: 15, icon: "🏃", dangerous: true },
                        { text: "🕯️ Зажечь спичку", anxiety: 4, score: 25, icon: "🕯️", type: "safe" },
                        { text: "👂 Прислушаться к звукам", anxiety: 5, score: 20, icon: "👂", type: "safe" },
                        { text: "🤚 Коснуться тени", anxiety: 12, score: 30, icon: "🤚", dangerous: true }
                    ]
                },
                // Уровень 3: Зеркальная комната
                {
                    level: 3,
                    title: "Зеркальная комната",
                    subtitle: "Множество отражений",
                    text: "Комната полна зеркал. Ваше отражение странно улыбается, хотя вы этого не делаете. Одно из отражений показывает другое место...",
                    choices: [
                        { text: "👁️ Смотреть в своё отражение", anxiety: 7, score: 20, icon: "👁️" },
                        { text: "🔨 Разбить ближайшее зеркало", anxiety: 15, score: 35, icon: "🔨", dangerous: true },
                        { text: "🚶 Идти к странному отражению", anxiety: 9, score: 30, icon: "🚶" },
                        { text: "🙈 Закрыть глаза и идти наощупь", anxiety: 13, score: 40, icon: "🙈", dangerous: true }
                    ]
                },
                // Уровень 4: Библиотека забытых слов
                {
                    level: 4,
                    title: "Библиотека",
                    subtitle: "Книги без названий",
                    text: "Вы в огромной библиотеке. Книги написаны на неизвестном языке. Одна книга светится в темноте. На столе лежит письмо с вашим именем...",
                    choices: [
                        { text: "📖 Открыть светящуюся книгу", anxiety: 11, score: 35, icon: "📖", dangerous: true },
                        { text: "✉️ Прочитать письмо", anxiety: 6, score: 25, icon: "✉️", type: "safe" },
                        { text: "🔦 Искать выход с фонарём", anxiety: 8, score: 30, icon: "🔦" },
                        { text: "🪑 Сесть и подождать", anxiety: 3, score: 20, icon: "🪑", type: "safe" }
                    ]
                },
                // Уровень 5: Лестница решений
                {
                    level: 5,
                    title: "Лестница",
                    subtitle: "Вверх или вниз?",
                    text: "Перед вами лестница. Вверх ведёт к свету, но слышны крики. Вниз - абсолютная темнота и тишина. Посередине дверь с надписью 'Не открывать'.",
                    choices: [
                        { text: "⬆️ Подняться к свету", anxiety: 9, score: 35, icon: "⬆️" },
                        { text: "⬇️ Спуститься в темноту", anxiety: 14, score: 45, icon: "⬇️", dangerous: true },
                        { text: "🚪 Открыть запретную дверь", anxiety: 16, score: 55, icon: "🚪", dangerous: true },
                        { text: "🧘 Остаться на месте и медитировать", anxiety: -5, score: 30, icon: "🧘", type: "safe" }
                    ]
                },
                // Уровень 6: Комната выборов
                {
                    level: 6,
                    title: "Выбор",
                    subtitle: "Цена решений",
                    text: "Вы в комнате с тремя дверями. Над первой написано 'Истина', над второй 'Ложь', над третьей 'Забвение'. Четвёртая дверь без надписи медленно открывается...",
                    choices: [
                        { text: "✨ Истина", anxiety: 10, score: 50, icon: "✨" },
                        { text: "🎭 Ложь", anxiety: 8, score: 40, icon: "🎭" },
                        { text: "🌫️ Забвение", anxiety: 6, score: 35, icon: "🌫️", type: "safe" },
                        { text: "❓ Войти в открывающуюся дверь", anxiety: 15, score: 60, icon: "❓", dangerous: true }
                    ]
                },
                // Уровень 7: Сад памяти
                {
                    level: 7,
                    title: "Сад памяти",
                    subtitle: "Что было реальным?",
                    text: "Вы в прекрасном саду. Каждый цветок - это ваше воспоминание. Некоторые цветы увядают. Садовник предлагает вам выбрать, какие воспоминания сохранить...",
                    choices: [
                        { text: "🌹 Сохранить счастливые моменты", anxiety: 5, score: 40, icon: "🌹", type: "safe" },
                        { text: "🥀 Сохранить болезненные уроки", anxiety: 12, score: 55, icon: "🥀", dangerous: true },
                        { text: "🌺 Создать новые воспоминания", anxiety: 8, score: 50, icon: "🌺" },
                        { text: "🔥 Сжечь все воспоминания", anxiety: 18, score: 70, icon: "🔥", dangerous: true }
                    ]
                },
                // Уровень 8: Зал эмоций
                {
                    level: 8,
                    title: "Зал эмоций",
                    subtitle: "Чувства овеществлённые",
                    text: "Огромный зал, где эмоции материализовались. Страх - тёмная тень в углу. Радость - яркий свет у потолка. Гнев - красное пламя. Печаль - синий туман. Что вы выберете?",
                    choices: [
                        { text: "😨 Противостоять страху", anxiety: 13, score: 65, icon: "😨", dangerous: true },
                        { text: "😊 Обнять радость", anxiety: 4, score: 45, icon: "😊", type: "safe" },
                        { text: "😤 
    <div id="top-bar">
        <div class="stat-box">
            <span>🎯 Уровень: <span class="stat-value" id="current-level">1</span></span>
        </div>
        <div class="stat-box">
            <span>⭐ Баллы: <span class="stat-value" id="score">0</span></span>
        </div>
        <div class="stat-box">
            <span>💎 Решений: <span class="stat-value" id="decisions">0</span></span>
        </div>
    </div>
    
    <div class="anxiety-bar">
        <div class="anxiety-fill" id="anxiety-fill" style="width: 0%"></div>
    </div>

    <div id="content">
        <div id="menu-screen" class="screen active">
            <h1 class="game-title">🎭 ТЕНИ СОЗНАНИЯ</h1>
            <p class="game-subtitle">Психологический триллер</p>
            <div class="menu-description">
                Погрузитесь в мир внутренних страхов и противоречий. 
                Каждое решение имеет последствия. Каждый выбор меняет вас.
                Сможете ли вы сохранить рассудок?
            </div>
            <button class="btn" onclick="game.startGame()">🎮 Начать игру</button>
            <button class="btn btn-secondary" onclick="game.showRules()">📖 Правила</button>
        </div>

        <div id="game-screen" class="screen">
            <div class="level-indicator">
                <div class="level-title" id="level-title">Уровень 1</div>
                <div class="level-subtitle" id="level-subtitle">Пробуждение</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                </div>
            </div>
            <div class="scenario-box">
                <div class="scenario-text" id="scenario-text">Загрузка...</div>
            </div>
            <div class="choices" id="choices"></div>
        </div>

        <div id="result-screen" class="screen">
            <h2 class="result-title" id="result-title">Конец игры</h2>
            <div class="result-stats">
                <div class="result-stat">
                    <div class="result-stat-value" id="final-score">0</div>
                    <div class="result-stat-label">Баллов</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value" id="final-level">0</div>
                    <div class="result-stat-label">Уровней</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value" id="final-decisions">0</div>
                    <div class="result-stat-label">Решений</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value" id="final-anxiety">0%</div>
                    <div class="result-stat-label">Тревоги</div>
                </div>
            </div>
            <div class="result-message" id="result-message"></div>
            <button class="btn" onclick="game.restartGame()">🔄 Играть снова</button>
            <button class="btn btn-secondary" onclick="game.backToMenu()">🏠 В меню</button>
        </div>
    </div>
</div>

<script>
    const game = {
        state: {
            currentLevel: 1,
            score: 0,
            anxiety: 0,
            decisions: 0,
            currentScenarioIndex: 0,
            gameActive: false
        },

        scenarios: [
            {
                level: 1, title: "Пробуждение", subtitle: "Туманное утро",
                text: "Вы просыпаетесь в незнакомой комнате. Стены покрыты странными символами. За окном густой туман. Телефон на столе мигает. Что делать?",
                choices: [
                    { text: "📱 Проверить телефон", anxiety: 5, score: 15 },
                    { text: "🚪 Выйти из комнаты", anxiety: 10, score: 20, dangerous: true },
                    { text: "🔍 Изучить символы", anxiety: 3, score: 25, safe: true },
                    { text: "🪟 Смотреть в окно", anxiety: 7, score: 18 }
                ]
            },
            {
                level: 2, title: "Коридор", subtitle: "Тени на стенах",
                text: "Бесконечный коридор. Странные тени на стенах пляшут без источника света. Слышны шаги...",
                choices: [
                    { text: "🏃 Побежать", anxiety: 12, score: 20, dangerous: true },
                    { text: "🕯️ Зажечь спичку", anxiety: 6, score: 30, safe: true },
                    { text: "👂 Прислушаться", anxiety: 8, score: 25 },
                    { text: "🤚 Коснуться тени", anxiety: 15, score: 35, dangerous: true }
                ]
            },
            {
                level: 3, title: "Зеркала", subtitle: "Множество отражений",
                text: "Комната полна зеркал. Ваше отражение странно улыбается, хотя вы этого не делаете...",
                choices: [
                    { text: "👁️ Смотреть в глаза", anxiety: 10, score: 25 },
                    { text: "🔨 Разбить зеркало", anxiety: 18, score: 40, dangerous: true },
                    { text: "🚶 Пройти дальше", anxiety: 7, score: 30, safe: true },
                    { text: "🙈 Закрыть глаза", anxiety: 14, score: 35 }
                ]
            },
            {
                level: 4, title: "Библиотека", subtitle: "Забытые знания",
                text: "Огромная библиотека. Книги на неизвестном языке. Одна светится в темноте...",
                choices: [
                    { text: "📖 Открыть книгу", anxiety: 13, score: 40, dangerous: true },
                    { text: "✉️ Прочитать письмо", anxiety: 8, score: 30, safe: true },
                    { text: "🔦 Искать выход", anxiety: 10, score: 35 },
                    { text: "🪑 Подождать", anxiety: 5, score: 25, safe: true }
                ]
            },
            {
                level: 5, title: "Лестница", subtitle: "Выбор пути",
                text: "Лестница. Вверх - к свету и крикам. Вниз - в темноту и тишину. Посередине - запретная дверь.",
                choices: [
                    { text: "⬆️ Вверх к свету", anxiety: 11, score: 40 },
                    { text: "⬇️ Вниз в темноту", anxiety: 16, score: 50, dangerous: true },
                    { text: "🚪 Открыть дверь", anxiety: 19, score: 60, dangerous: true },
                    { text: "🧘 Медитировать", anxiety: -8, score: 35, safe: true }
                ]
            },
            {
                level: 6, title: "Выбор", subtitle: "Три двери",
                text: "'Истина', 'Ложь', 'Забвение'. Четвёртая дверь без надписи открывается сама...",
                choices: [
                    { text: "✨ Истина", anxiety: 12, score: 55 },
                    { text: "🎭 Ложь", anxiety: 10, score: 45 },
                    { text: "🌫️ Забвение", anxiety: 8, score: 40, safe: true },
                    { text: "❓ Таинственная дверь", anxiety: 17, score: 65, dangerous: true }
                ]
            },
            {
                level: 7, title: "Сад памяти", subtitle: "Воспоминания",
                text: "Прекрасный сад. Каждый цветок - ваше воспоминание. Некоторые увядают...",
                choices: [
                    { text: "🌹 Счастливые моменты", anxiety: 6, score: 45, safe: true },
                    { text: "🥀 Болезненные уроки", anxiety: 14, score: 60, dangerous: true },
                    { text: "🌺 Новые воспоминания", anxiety: 10, score: 55 },
                    { text: "🔥 Сжечь всё", anxiety: 20, score: 75, dangerous: true }
                ]
            },
            {
                level: 8, title: "Эмоции", subtitle: "Материализация чувств",
                text: "Зал эмоций. Страх - тень, Радость - свет, Гнев - пламя, Печаль - туман.",
                choices: [
                    { text: "😨 Страх", anxiety: 15, score: 70, dangerous: true },
                    { text: "😊 Радость", anxiety: 5, score: 50, safe: true },
                    { text: "😤 Гнев", anxiety: 18, score: 75, dangerous: true },
                    { text: "😢 Печаль", anxiety: 12, score: 60 }
                ]
            },
            {
                level: 9, title: "Последняя дверь", subtitle: "Почти конец",
                text: "За дверью - выход или ловушка? Голос предлагает остаться. Здесь безопасно...",
                choices: [
                    { text: "🚪 Открыть дверь", anxiety: 13, score: 75 },
                    { text: "🏠 Остаться", anxiety: 8, score: 45, safe: true },
                    { text: "🔓 Взломать силой", anxiety: 22, score: 90, dangerous: true },
                    { text: "🤔 Задать вопрос", anxiety: 10, score: 65 }
                ]
            },
            {
                level: 10, title: "Финал", subtitle: "Пробуждение",
                text: "Это был ваш разум. Все страхи - ваши. Проснуться или остаться в глубинах сознания?",
                choices: [
                    { text: "☀️ Проснуться", anxiety: 0, score: 100, safe: true },
                    { text: "🌙 Остаться", anxiety: 25, score: 95, dangerous: true },
                    { text: "♾️ Начать заново", anxiety: 12, score: 85 },
                    { text: "🎭 Принять обе реальности", anxiety: 20, score: 120, dangerous: true }
                ]
            }
        ],

        init() {
            this.updateUI();
        },

        startGame() {
            this.state = {
                currentLevel: 1,
                score: 0,
                anxiety: 0,
                decisions: 0,
                currentScenarioIndex: 0,
                gameActive: true
            };
            this.showScreen('game-screen');
            this.loadScenario();
        },

        loadScenario() {
            const scenario = this.scenarios[this.state.currentScenarioIndex];
            if (!scenario) {
                this.endGame();
                return;
            }

            document.getElementById('level-title').textContent = `Уровень ${scenario.level}`;
            document.getElementById('level-subtitle').textContent = scenario.subtitle;
            document.getElementById('scenario-text').textContent = scenario.text;

            const progress = (this.state.currentScenarioIndex / this.scenarios.length) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';

            const choicesContainer = document.getElementById('choices');
            choicesContainer.innerHTML = '';

            scenario.choices.forEach((choice, index) => {
                const choiceBtn = document.createElement('div');
                choiceBtn.className = 'choice' + (choice.dangerous ? ' dangerous' : choice.safe ? ' safe' : '');
                choiceBtn.textContent = choice.text;
                choiceBtn.onclick = () => this.makeChoice(choice);
                setTimeout(() => choicesContainer.appendChild(choiceBtn), index * 150);
            });

            this.updateUI();
        },

        makeChoice(choice) {
            this.state.score += choice.score;
            this.state.anxiety += choice.anxiety;
            this.state.decisions++;

            if (this.state.anxiety > 100) this.state.anxiety = 100;
            if (this.state.anxiety < 0) this.state.anxiety = 0;

            if (choice.dangerous) {
                document.getElementById('game-container').classList.add('shake');
                setTimeout(() => document.getElementById('game-container').classList.remove('shake'), 500);
            }

            // Проверка проигрыша
            if (this.state.anxiety >= 100) {
                setTimeout(() => this.endGame(true), 800);
                return;
            }

            this.updateUI();
            this.state.currentScenarioIndex++;
            this.state.currentLevel = this.state.currentScenarioIndex + 1;

            setTimeout(() => this.loadScenario(), 800);
        },

        updateUI() {
            document.getElementById('current-level').textContent = this.state.currentLevel;
            document.getElementById('score').textContent = this.state.score;
            document.getElementById('decisions').textContent = this.state.decisions;
            document.getElementById('anxiety-fill').style.width = this.state.anxiety + '%';

            const anxietyFill = document.getElementById('anxiety-fill');
            if (this.state.anxiety > 70) {
                anxietyFill.style.background = 'linear-gradient(90deg, #ff0000, #ff0066)';
            } else if (this.state.anxiety > 40) {
                anxietyFill.style.background = 'linear-gradient(90deg, #ffaa00, #ff6600)';
            } else {
                anxietyFill.style.background = 'linear-gradient(90deg, #00ff88, #ffaa00)';
            }
        },

        endGame(anxietyOverload = false) {
            this.state.gameActive = false;
            
            let resultTitle, resultMessage;
            
            if (anxietyOverload) {
                resultTitle = '😰 Поглощён страхом';
                resultMessage = 'Тревога достигла критического уровня. Разум не выдержал испытания. Попробуйте выбирать более безопасные пути.';
            } else if (this.state.score > 700) {
                resultTitle = '🏆 Мастер сознания';
                resultMessage = 'Невероятно! Вы прошли все испытания с блеском. Ваш разум силён, решения мудры.';
            } else if (this.state.score > 500) {
                resultTitle = '⭐ Искатель истины';
                resultMessage = 'Отличный результат! Вы нашли баланс между осторожностью и смелостью.';
            } else if (this.state.score > 300) {
                resultTitle = '🎭 Выживший';
                resultMessage = 'Вы справились, но путь был нелёгким. Страхи всё ещё преследуют вас.';
            } else {
                resultTitle = '🌫️ Потерянный';
                resultMessage = 'Лабиринт разума оказался слишком сложным. Но каждая попытка делает вас сильнее!';
            }

            document.getElementById('result-title').textContent = resultTitle;
            document.getElementById('result-message').textContent = resultMessage;
            document.getElementById('final-score').textContent = this.state.score;
            document.getElementById('final-level').textContent = this.state.currentLevel;
            document.getElementById('final-decisions').textContent = this.state.decisions;
            document.getElementById('final-anxiety').textContent = Math.round(this.state.anxiety) + '%';

            this.showScreen('result-screen');
        },

        showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        },

        restartGame() {
            this.startGame();
        },

        backToMenu() {
            this.showScreen('menu-screen');
        },

        showRules() {
            alert(`🎮 ПРАВИЛА ИГРЫ:
